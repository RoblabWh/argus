services:
  argus:
    image: argus
    build: ./app
    container_name: argus
    ports:
      - ${ARGUS_PORT}:5000
    volumes:
      - ${ARGUS_PROJECTS}:/app/static/projects:rw
    links:
      - nodeodm
      - detection
      - webodm
      - stella_vslam
    depends_on:
      - detection
      - nodeodm
      - webodm
      - stella_vslam
    environment:
      - ARGUS_WEBODM_PORT
    restart: unless-stopped
  detection:
    image: argus_mmdetection
    build: ./detection
    container_name: argus_detection
    expose:
      - ${ARGUS_DETECTION_PORT}:6666
    volumes:
      - ${ARGUS_PROJECTS}:/detection/static/projects:rw
    environment:
      - ARGUS_GPU_NVIDIA
      - ARGUS_GPU_INTEL
      - ARGUS_GPU_AMD
    restart: unless-stopped
  stella_vslam:
    image: stella_vslam_dense_argus
    build: ./stella_vslam_dense_argus
    container_name: argus_vslam
    mem_limit: 12g
    mem_reservation: 4g
    memswap_limit: 20g
    expose:
      - 7000
    volumes:
      - ${ARGUS_PROJECTS}:/stella_vslam/static/projects:rw
    restart: unless-stopped
volumes:
  projects:
