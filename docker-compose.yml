include:
  - docker-compose.nodeodm.yml
  - docker-compose.webodm.yml

services:
  argus:
    image: argus
    build: ./app
    container_name: argus
    ports:
      - ${ARGUS_PORT}:5000
    volumes:
      - ${ARGUS_PROJECTS}:/app/static/projects:rw
    links:
      - nodeodm
      - detection
      - webodm
    depends_on:
      - detection
      - nodeodm
      - webodm
    environment:
      - ARGUS_WEBODM_PORT
    restart: unless-stopped
  detection:
    image: argus_mmdetection
    build: ./detection
    container_name: argus_detection
    expose:
      - 6000
    volumes:
      - ${ARGUS_PROJECTS}:/detection/static/projects:rw
    #restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [ gpu ]

volumes:
  projects:
