services:
  argus:
    image: argus
    build: ./app
    container_name: argus
    ports:
      - ${ARGUS_PORT}:5000
    volumes:
      - ${ARGUS_PROJECTS}:/app/static/projects:rw
    links:
      - nodeodm
      - detection
    depends_on:
      - detection
      - nodeodm
    environment:
      - ARGUS_WEBODM_ADDRESS
      - ARGUS_WEBODM_PORT
      - ARGUS_WEBODM_USERNAME
      - ARGUS_WEBODM_PASSWORD
    restart: unless-stopped
  detection:
    image: argus_mmdetection
    build: ./detection
    container_name: argus_detection
    expose:
      - 6000
    volumes:
      - ${ARGUS_PROJECTS}:/detection/static/projects:rw
    environment:
      - ARGUS_GPU_NVIDIA
      - ARGUS_GPU_INTEL
      - ARGUS_GPU_AMD
    restart: unless-stopped

volumes:
  projects:
    name: argus_projects
